/*
    CheckRole: Easy Role Check

    Copyright 2018 KJSMAN. All rights reserved.
    This code is published with MIT License:
    You can get it from LICENSE file.
*/

const Statement = function(statement) {
    if(typeof statement !== "string") throw 'Statement is not a String';
    
    statement = statement.trim();

    const statement_regex = /^((\+|-)\w+)( (\+|-)\w+)*$/g
    if(!statement_regex.test(statement)) throw 'Invaild Statement'
    
    this.statement_str = statement;

    this.framed_statement = new Array();
    statement.split(' ').forEach(element => {
        var frame = new Object();
        if      (element.charAt(0) === '+') frame.accept = true;
        else if (element.charAt(0) === '-') frame.accept = false;
        else throw 'Invaild Statement';
        frame.role = element.substr(1);
        this.framed_statement.push(frame);
    });
    
    this.Pass = function (RoleList) {
        if(!Array.isArray(RoleList)) throw 'List of Role is not a Array';
        for (element of this.framed_statement) {
            if(element.role == "_all") {
                return element.accept;
            }

            if(RoleList.indexOf(element.role) !== -1) {
                return element.accept;
            }
        }
        throw 'Was neither Accepted nor Denied'
    }
    this.toString = function () {
        return this.statement_str;
    }

    return this;
}





module.exports = Statement;
